#!/bin/sh

cmd="SELECT count(*) FROM (SELECT DISTINCT dataset_id FROM feature) AS a"
n_datasets=$(psql $@ -t0 -c "$cmd")
[ $n_datasets -gt 0 ] && exit 0

# Make a temp dir
tempdir=$(mktemp -d)
trap 'rm -rf "$tempdir"' EXIT

cd "$tempdir"

# Import 110m Natural Earth data
baseurl="https://raw.githubusercontent.com/martynafford/natural-earth-geojson/master"
ds=ne_110m_land
fn="$ds.json"
curl -o "$fn" "$baseurl/110m/physical/$ds.json"
corelle import-features --overwrite $ds $fn


# Import Macrostrat polygons
ds="macrostrat_columns"
fn="$ds.json"


curl "https://macrostrat.org/api/v2/columns?all&format=geojson" \
| python -m jq .success.data > $fn
corelle import-features --overwrite $ds $fn
